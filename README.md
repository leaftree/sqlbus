# SQLBUS
SQL-BUS(SqlBus), forwarding SQL via Memory-Cache as a bus.
===

## SQLBUS 原理图
```c

+--------------------------------------------------------------------------------+
|   +------------------------------------------------------------------------+   |
|   |   ＳＴＲＵＣＴＵＲＡＬ ＳＣＨＥＭＡＴＩＣ ＤＩＡＧＲＡＭ ＯＦ ＳＱＬＢＵＳ   |   |
|   +------------------------------------------------------------------------+   |
|                                                                                |
|                  +------------------(1)-----------------+                      |
|                  |                                      |                      |
|                  |                                      v                      |
|        +---------+----------+                 +--------------------+           |
|        | TransactionProcess |<------(6)-------+    MemoryCahce     |           |
|        +--------------------+                 +------+-------------+           |
|           \         /                                |     ^                   |
|           [a]     [b]                               (2)    |                   |
|             \     /                                  |    (5)                  |
|              \   /                                   v     |                   |
|        +-------------------+                  +------------+-------+           |
|        |     DataBase      |<-------(3)-------|       SQLBUS       |           |
|        +--------+----------+                  +--------------------+           |
|                 |                                       ^                      |
|                 |                                       |                      |
|                 +-------------------(4)-----------------+                      |
|                                                                                |
+--------------------------------------------------------------------------------+
```

| 关键字                | 简称  | 名称       |
| ---                | --- | ---      |
| TransactionProcess | TP  | 业务处理进程   |
| MemoryCahce        | MC  | 内存数据库    |
| DataBase           | DB  | 数据库      |
| SQLBUS             | SB  | sqlbus服务 |

  在原来的架构中，TP通过直连DB进行数据库作，如结构图中[a]和[b]步骤；TP直接将SQL语句传输到DB中，然后等待DB返回操作结果。
然而有一些操作的结果不需要即可使用的，在这种结构下，TP会消耗大量时间在等待DB完成处理，这是不必要的等待。

  在SQLBUS的架构中，TP会将一些耗时并且不需要实时的数据库操作存储在MC中，然后继续处理后续业务流程；SB服务则会一直尝试读
取MC中的请求数据，当接收到一个"合法"的请求时，就会将请求传输到DB中进行处理。

  合法的请求，是指符合既定SQLBUS格式的请求数据，请查看[SQLBUS请求格式](#sqlbus请求格式)

### SQLBUS请求格式
```c
```

### SQLBUS响应格式
#### 查询语句响应格式
#### 非查询语句响应格式
#### 执行语句出错响应格式
```c
```

### test
- [A test config](document/test.ini.md)

## TODO LIST
- BUG，尝试连接时存在内存泄露问题
- 接收SIGHUP信号时重新读取配置文件
- 接收退出信号时正常退出sqlbus，现在只能通过kill -9退出
- 日志文件被改动时sqlbus无法写入日志记录
- 启动sqlbus时指定连接数据库
- 由业务进程指定要连接的数据库
- 封装业务层接口
- 编写说明及驱动接口编写规则

